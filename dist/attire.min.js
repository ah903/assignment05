angular.module("attire-app").controller("BasketController",["$scope","$rootScope","BasketFactory",function(t,o,r){function e(){t.Basket=r.getBasket()}o.$on("OnBasketChanged",e),e(),t.updateBasket=function(t){r.updateBasket(t)},t.removeFromBasket=function(t){r.removeFromBasket(t)}}]),angular.module("attire-app").controller("CheckoutController",["$scope",function(t){console.log("Checkout Controller"),t.greeting="Welcome Andrew Checkout Controller"}]),angular.module("attire-app").controller("DetailController",["$scope","$routeParams","$rootScope","ProductFactory","BasketFactory",function(t,o,r,e,n){e.getProductById(o.productId).then(function(o){t.CurrentProduct=o,t.sizeOption=o.sizes[0],t.colorOption=o.colors[0]}),t.AddToBasket=function(o){var e=(t.sizeOption,t.colorOption,{quantityOption:1,sizeOption:t.sizeOption,colorOption:t.colorOption});t.Basket=n.addToBasket(o,e),r.$broadcast("OnBasketChanged",t.Basket)},t.GetBasket=function(){t.Basket=n.getBasket()}}]),angular.module("attire-app").controller("HomeController",["$scope",function(t){t.greeting="Welcome Andrew Home Controller"}]),angular.module("attire-app").controller("LoginController",["$scope","$location","$rootScope","CustomerFactory",function(t,o,r,e){var n={ErrorAuthenticationMessage:"Incorrect username or password"};t.login=function(a){e.loginUser(a,function(e){e?(t.loginError="",r.CurrentUser=e,o.url("/home")):t.errorMessage=n.ErrorAuthenticationMessage})},t.logout=function(){r.CurrentUser=null}}]),angular.module("attire-app").controller("ProductController",["$scope","$routeParams","ProductFactory",function(t,o,r){var e=r.getProductsForGroupCategory(o.group,o.category);e.success(function(o){t.products=o})}]),angular.module("attire-app").controller("RegisterController",["$scope","$location","CustomerFactory",function(t,o,r){t.JoinUp=function(){var e=t.user;r.registerUser(e,function(r){r?o.path("/home"):t.errorMessage="Opps"})}}]),angular.module("attire-app").service("BasketEventService",["$rootScope",function(t){this.broadcast=function(){t.$broadcast("OnBasketChanged")},this.listen=function(o){t.$on("OnBasketChanged",o)}}]),angular.module("attire-app").factory("BasketFactory",function(){function t(t,o){for(var r=0;r<e.items.length;r++){var n=e.items[r];if(n.product.productId===t.productId&&n.productOptions.sizeOption===o.sizeOption&&n.productOptions.colorOption===o.colorOption)return n}return null}function o(t){for(var o=0,e=0,n=0;n<t.items.length;n++)t.items[n].subTotal=r(t.items[n].price,t.items[n].quantity),o+=t.items[n].subTotal,e+=t.items[n].quantity;t.total=o,t.count=e}function r(t,o){return t*o}var e={userId:"",total:0,count:0,items:[]},n=function(r,n){var a=t(r,n),u=Number(r.price.replace(/[^0-9\.]+/g,""));if(a){var i=a.quantity+n.quantityOption;a.productOptions.quantity=i,a.quantity=i,a.price=u}else{var c={product:r,productOptions:n,price:u,quantity:n.quantityOption};e.items.push(c)}return o(e),e},a=function(t){return t.quantity?(t.productOptions.quantity=t.quantity,o(e),e):void 0},u=function(t){if(t){var r=e.items.indexOf(t);return e.items.splice(r,1),o(e),e}},i=function(){return e};return{addToBasket:n,updateBasket:a,removeFromBasket:u,getBasket:i}}),angular.module("attire-app").factory("CustomerFactory",["$http",function(t){var o={LoginEndPoint:"/api/customers/login",RegisterEndPoint:"/api/customers/register"},r=function(r,e){t.post(o.LoginEndPoint,r).success(function(t){e(t)})},e=function(r,e){t.post(o.RegisterEndPoint,r).success(function(t){e(t)})},n=function(r,e){t.put(o.RegisterEndPoint,r).success(function(t){e(t)})};return{loginUser:r,registerUser:e,updateUser:n}}]),angular.module("attire-app").factory("DataFactory",["$http",function(t){var o=function(o,r){var e="/api/products/?group="+o+"&category="+r;return t.get(e)},r=function(o){var r="/api/products/"+o.productId;return t.get(r)},e=function(o){var r="/api/products/"+o.productId+"/reviews";return t.get(r)};return{getProducts:o,getProduct:r,getReviews:e}}]),angular.module("attire-app").factory("ProductFactory",["$http",function(t){var o="/api/products/",r=function(r,e){var n=o+"?group="+r+"&category="+e,a=t.get(n);return a.then(function(t){return t.data}),a},e=function(r){var e=o+r,n=o+r+"/reviews",a=null;return t.get(e).then(function(o){return a=o.data,t.get(n)}).then(function(t){return a.reviews=t.data,a})};return{getProductsForGroupCategory:r,getProductById:e}}]);