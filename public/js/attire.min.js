angular.module("attire-app").controller("BasketController",["$scope","$rootScope","BasketFactory",function(t,e,r){function o(){t.Basket=r.getBasket()}e.$on("OnBasketChanged",o),o(),t.updateBasket=function(t){r.updateBasket(t)},t.removeFromBasket=function(t){r.removeFromBasket(t)}}]),angular.module("attire-app").controller("DetailController",["$scope","$routeParams","$rootScope","ProductFactory","BasketFactory",function(t,e,r,o,n){o.getProductById(e.productId).then(function(e){t.CurrentProduct=e,t.sizeOption=e.sizes[0],t.colorOption=e.colors[0]}),t.AddToBasket=function(e){var o=(t.sizeOption,t.colorOption,{quantityOption:1,sizeOption:t.sizeOption,colorOption:t.colorOption});t.Basket=n.addToBasket(e,o),r.$broadcast("OnBasketChanged",t.Basket)},t.GetBasket=function(){t.Basket=n.getBasket()}}]),angular.module("attire-app").controller("HomeController",["$scope","ProductFactory",function(t,e){var r={SpecialOffer:"Special Offer",NewCollection:"New",Save10Percent:"Save 10%",Save20Percent:"Save 20%"},o=e.getProductsOnOffer(r.SpecialOffer);o.success(function(e){t.specialOffers=e});var n=e.getProductsOnOffer(r.NewCollection);n.success(function(e){t.newStock=e})}]),angular.module("attire-app").controller("LoginController",["$scope","$location","$rootScope","CustomerFactory",function(t,e,r,o){var n={ErrorAuthenticationMessage:"Incorrect username or password"};t.login=function(a){o.loginUser(a,function(o){o?(t.loginError="",r.CurrentUser=o,e.url("/home")):t.errorMessage=n.ErrorAuthenticationMessage})},t.logout=function(){r.CurrentUser=null,e.url("/home")}}]),angular.module("attire-app").controller("OrderController",["$scope","$rootScope","BasketFactory","OrderFactory",function(t,e,r,o){t.Basket=r.getBasket(),t.Basket.user=e.CurrentUser,t.PlaceOrder=function(){console.log("Place Order"),t.Basket.payment=t.payment,o.placeOrder(t.Basket)}}]),angular.module("attire-app").controller("ProductController",["$scope","$routeParams","ProductFactory",function(t,e,r){var o=r.getProductsForGroupCategory(e.group,e.category);o.success(function(e){t.products=e})}]),angular.module("attire-app").controller("RegisterController",["$scope","$location","CustomerFactory",function(t,e,r){t.JoinUp=function(){var o=t.user;r.registerUser(o,function(r){r?e.path("/home"):t.errorMessage="Error Registering User"})}}]),angular.module("attire-app").factory("BasketFactory",function(){function t(t,e){for(var r=0;r<o.items.length;r++){var n=o.items[r];if(n.product.productId===t.productId&&n.productOptions.sizeOption===e.sizeOption&&n.productOptions.colorOption===e.colorOption)return n}return null}function e(t){for(var e=0,o=0,n=0;n<t.items.length;n++)t.items[n].subTotal=r(t.items[n].price,t.items[n].quantity),e+=t.items[n].subTotal,o+=t.items[n].quantity;t.total=e,t.count=o}function r(t,e){return t*e}var o={total:0,count:0,items:[]},n=function(r,n){var a=t(r,n),u=Number(r.price.replace(/[^0-9\.]+/g,""));if(a){var c=a.quantity+n.quantityOption;a.productOptions.quantity=c,a.quantity=c,a.price=u}else{var i={product:r,productOptions:n,price:u,quantity:n.quantityOption};o.items.push(i)}return e(o),o},a=function(t){return t.quantity?(t.productOptions.quantity=t.quantity,e(o),o):void 0},u=function(t){if(t){var r=o.items.indexOf(t);return o.items.splice(r,1),e(o),o}},c=function(){return o};return{addToBasket:n,updateBasket:a,removeFromBasket:u,getBasket:c}}),angular.module("attire-app").factory("CustomerFactory",["$http",function(t){var e={LoginEndPoint:"/api/customers/login",RegisterEndPoint:"/api/customers/register"},r=function(r,o){t.post(e.LoginEndPoint,r).success(function(t){o(t)})},o=function(r,o){t.post(e.RegisterEndPoint,r).success(function(t){o(t)})},n=function(r,o){t.put(e.RegisterEndPoint,r).success(function(t){o(t)})};return{loginUser:r,registerUser:o,updateUser:n}}]),angular.module("attire-app").factory("OrderFactory",["$http",function(t){var e={CustomerEndPoint:"/api/customers/"},r=function(r,o){console.log("Place Order Factory");var n=e.CustomerEndPoint+r.user._Id+"/orders";t.post(n,r).success(function(t){o(t)})};return{placeOrder:r}}]),angular.module("attire-app").factory("ProductFactory",["$http",function(t){var e="/api/products/",r=function(r,o){var n=e+"?group="+r+"&category="+o,a=t.get(n);return a.then(function(t){return t.data}),a},o=function(r){var o=e+r,n=e+r+"/reviews",a=null;return t.get(o).then(function(e){return a=e.data,t.get(n)}).then(function(t){return a.reviews=t.data,a})},n=function(r){var o=e+"?promotion="+r,n=t.get(o);return n.then(function(t){return t.data}),n};return{getProductsForGroupCategory:r,getProductsOnOffer:n,getProductById:o}}]),angular.module("attire-app").service("BasketEventService",["$rootScope",function(t){this.broadcast=function(){t.$broadcast("OnBasketChanged")},this.listen=function(e){t.$on("OnBasketChanged",e)}}]);