angular.module("attire-app").controller("BasketController",["$scope","$rootScope","BasketFactory",function(t,o,e){function r(){t.Basket=e.getBasket()}o.$on("OnBasketChanged",r),r(),t.updateBasket=function(t){e.updateBasket(t)},t.removeFromBasket=function(t){e.removeFromBasket(t)}}]),angular.module("attire-app").controller("CheckoutController",["$scope",function(t){console.log("Checkout Controller"),t.greeting="Welcome Andrew Checkout Controller"}]),angular.module("attire-app").controller("DetailController",["$scope","$routeParams","$rootScope","ProductFactory","BasketFactory",function(t,o,e,r,n){r.getProductById(o.productId).then(function(o){t.CurrentProduct=o,t.sizeOption=o.sizes[0],t.colorOption=o.colors[0]}),t.AddToBasket=function(o){var r=(t.sizeOption,t.colorOption,{quantityOption:1,sizeOption:t.sizeOption,colorOption:t.colorOption});t.Basket=n.addToBasket(o,r),e.$broadcast("OnBasketChanged",t.Basket)},t.GetBasket=function(){t.Basket=n.getBasket()}}]),angular.module("attire-app").controller("HomeController",["$scope","ProductFactory",function(t,o){var e={SpecialOffer:"Special Offer",NewCollection:"New",Save10Percent:"Save 10%",Save20Percent:"Save 20%"},r=o.getProductsOnOffer(e.SpecialOffer);r.success(function(o){t.specialOffers=o});var n=o.getProductsOnOffer(e.NewCollection);n.success(function(o){t.newStock=o})}]),angular.module("attire-app").controller("LoginController",["$scope","$location","$rootScope","CustomerFactory",function(t,o,e,r){var n={ErrorAuthenticationMessage:"Incorrect username or password"};t.login=function(a){r.loginUser(a,function(r){r?(t.loginError="",e.CurrentUser=r,o.url("/home")):t.errorMessage=n.ErrorAuthenticationMessage})},t.logout=function(){e.CurrentUser=null}}]),angular.module("attire-app").controller("ProductController",["$scope","$routeParams","ProductFactory",function(t,o,e){var r=e.getProductsForGroupCategory(o.group,o.category);r.success(function(o){t.products=o})}]),angular.module("attire-app").controller("RegisterController",["$scope","$location","CustomerFactory",function(t,o,e){t.JoinUp=function(){var r=t.user;e.registerUser(r,function(e){e?o.path("/home"):t.errorMessage="Error Registering User"})}}]),angular.module("attire-app").factory("BasketFactory",function(){function t(t,o){for(var e=0;e<r.items.length;e++){var n=r.items[e];if(n.product.productId===t.productId&&n.productOptions.sizeOption===o.sizeOption&&n.productOptions.colorOption===o.colorOption)return n}return null}function o(t){for(var o=0,r=0,n=0;n<t.items.length;n++)t.items[n].subTotal=e(t.items[n].price,t.items[n].quantity),o+=t.items[n].subTotal,r+=t.items[n].quantity;t.total=o,t.count=r}function e(t,o){return t*o}var r={userId:"",total:0,count:0,items:[]},n=function(e,n){var a=t(e,n),i=Number(e.price.replace(/[^0-9\.]+/g,""));if(a){var u=a.quantity+n.quantityOption;a.productOptions.quantity=u,a.quantity=u,a.price=i}else{var c={product:e,productOptions:n,price:i,quantity:n.quantityOption};r.items.push(c)}return o(r),r},a=function(t){return t.quantity?(t.productOptions.quantity=t.quantity,o(r),r):void 0},i=function(t){if(t){var e=r.items.indexOf(t);return r.items.splice(e,1),o(r),r}},u=function(){return r};return{addToBasket:n,updateBasket:a,removeFromBasket:i,getBasket:u}}),angular.module("attire-app").factory("CustomerFactory",["$http",function(t){var o={LoginEndPoint:"/api/customers/login",RegisterEndPoint:"/api/customers/register"},e=function(e,r){t.post(o.LoginEndPoint,e).success(function(t){r(t)})},r=function(e,r){t.post(o.RegisterEndPoint,e).success(function(t){r(t)})},n=function(e,r){t.put(o.RegisterEndPoint,e).success(function(t){r(t)})};return{loginUser:e,registerUser:r,updateUser:n}}]),angular.module("attire-app").factory("ProductFactory",["$http",function(t){var o="/api/products/",e=function(e,r){var n=o+"?group="+e+"&category="+r,a=t.get(n);return a.then(function(t){return t.data}),a},r=function(e){var r=o+e,n=o+e+"/reviews",a=null;return t.get(r).then(function(o){return a=o.data,t.get(n)}).then(function(t){return a.reviews=t.data,a})},n=function(e){var r=o+"?promotion="+e,n=t.get(r);return n.then(function(t){return t.data}),n};return{getProductsForGroupCategory:e,getProductsOnOffer:n,getProductById:r}}]),angular.module("attire-app").service("BasketEventService",["$rootScope",function(t){this.broadcast=function(){t.$broadcast("OnBasketChanged")},this.listen=function(o){t.$on("OnBasketChanged",o)}}]);