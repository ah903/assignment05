///////////////////////////////////////////////////////////////////////////////////////////////////
// Customer Factory 
// Singleton Factory Responsible for managing connection to backend database
// Follows a pattern of using $http object to connect to an API endpoint
// and post processing the promise with the .then construct to make it simpler
// for consuming controllers
///////////////////////////////////////////////////////////////////////////////////////////////////
// This pattern is also useful to hide physical data storage implementations
// from controllers so a controller may make a single call to the factory and
// not need to know that the factory may chain multiple promises to assemble
// the data requested
///////////////////////////////////////////////////////////////////////////////////////////////////
// Dependencies
// $http injected in
///////////////////////////////////////////////////////////////////////////////////////////////////
angular.module("attire-app").factory("CustomerFactory",["$http", function($http){

	/////////////////////////////////////////////////////////////////////////
	// Private Variables
	/////////////////////////////////////////////////////////////////////////
	var loggedInUser = null;

	/////////////////////////////////////////////////////////////////////////
	// Function currentUser
	/////////////////////////////////////////////////////////////////////////
	// Returns the currently logged in User
	/////////////////////////////////////////////////////////////////////////
	// Returns Customer	
	/////////////////////////////////////////////////////////////////////////
	var currentUser = function(){
		return loggedInUser;
	}

	/////////////////////////////////////////////////////////////////////////
	// Function login
	/////////////////////////////////////////////////////////////////////////
	// Passes the user credentials to the server for authentication
	/////////////////////////////////////////////////////////////////////////
	// Returns Promise	
	/////////////////////////////////////////////////////////////////////////
	var login = function(user, callback){
		var serviceEndPoint = "/api/customers/login";
		
		$http.post(serviceEndPoint,user)
		.success(function(response){
			callback(response);
		})


		//var promise = $http.post(serviceEndPoint,user);
		//promise.then(function(results){
		//	if(results.data) loggedInUser=results.data;
		//	return results.data;
		//});
		//return promise;
	};


	/////////////////////////////////////////////////////////////////////////
	// Function logout
	/////////////////////////////////////////////////////////////////////////
	// Passes the user credentials to the server for authentication
	/////////////////////////////////////////////////////////////////////////
	// Returns Promise	
	/////////////////////////////////////////////////////////////////////////
	var logout = function(user){
		loggedInUser = null;
	}

	/////////////////////////////////////////////////////////////////////////
	// Public Interface to the Factory Exposed as an Object literal
	// Set of pointers to private functions
	/////////////////////////////////////////////////////////////////////////
	return{
		currentUser:currentUser,
		login:login,
		logout:logout
	};

}]);